import type { PersonalInfo, Skill, Project, Experience, BlogPost, Education, Certification } from "../data/portfolio"

export function createProgressBar(level: number, length = 20): string {
  // Adjust progress bar length for mobile
  const isMobile = typeof window !== "undefined" && window.innerWidth < 640
  const barLength = isMobile ? 10 : length
  const filled = Math.round((level / 100) * barLength)
  const empty = barLength - filled
  return "‚ñà".repeat(filled) + "‚ñë".repeat(empty)
}

export function getTerminalWidth(): number {
  if (typeof window === "undefined") return 60
  const width = window.innerWidth
  if (width < 640) return 50 // Mobile
  if (width < 768) return 40 // Tablet
  return 60 // Desktop
}

export function createBox(title: string, content: string[], width?: number): string {
  const terminalWidth = width || getTerminalWidth()
  const innerWidth = terminalWidth - 4

  let output = `‚îå${"‚îÄ".repeat(terminalWidth - 2)}‚îê\n`
  output += `‚îÇ ${title.padEnd(innerWidth - 1)} ‚îÇ\n`
  output += `‚îú${"‚îÄ".repeat(terminalWidth - 2)}‚î§\n`

  content.forEach((line) => {
    if (line.length <= innerWidth) {
      output += `‚îÇ ${line.padEnd(innerWidth - 1)} ‚îÇ\n`
    } else {
      // Break long lines
      const words = line.split(" ")
      let currentLine = ""
      words.forEach((word) => {
        if ((currentLine + word).length <= innerWidth - 1) {
          currentLine += (currentLine ? " " : "") + word
        } else {
          if (currentLine) {
            output += `‚îÇ ${currentLine.padEnd(innerWidth - 1)} ‚îÇ\n`
          }
          currentLine = word
        }
      })
      if (currentLine) {
        output += `‚îÇ ${currentLine.padEnd(innerWidth - 1)} ‚îÇ\n`
      }
    }
  })

  output += `‚îî${"‚îÄ".repeat(terminalWidth - 2)}‚îò\n`
  return output
}

export function formatPersonalInfo(data: PersonalInfo): string {
  const width = getTerminalWidth()
  const isMobile = width < 50

  return `
${isMobile ? "‚ïê".repeat(width) : "‚ïî" + "‚ïê".repeat(width - 2) + "‚ïó"}
${isMobile ? ` ABOUT ${data.name.toUpperCase()}` : `‚ïë${`                   ABOUT ${data.name.toUpperCase()}`.padEnd(width - 2)}‚ïë`}
${isMobile ? "‚ïê".repeat(width) : "‚ïö" + "‚ïê".repeat(width - 2) + "‚ïù"}

üë®‚Äçüíª ${data.title} | üåç ${data.location} | ‚òï Coffee Enthusiast

‚Äé\nOVERVIEW
${"=".repeat(8)}
${data.bio}

‚Äé\nBACKGROUND
${"=".repeat(10)}
‚Ä¢ üéì Computer Science graduate with a focus on web technologies
‚Ä¢ üöÄ Started coding during university, fell in love with the craft
‚Ä¢ üè¢ Worked with startups and established companies
‚Ä¢ üå± Always learning and exploring new technologies

‚Äé\nPHILOSOPHY
${"=".repeat(10)}
"${data.philosophy}"

I believe in:
‚Ä¢ Writing clean, maintainable code
‚Ä¢ Creating user-centric experiences  
‚Ä¢ Continuous learning and improvement
‚Ä¢ Collaboration and knowledge sharing

‚Äé\nWHEN I'M NOT CODING
${"=".repeat(19)}
${data.interests.join("\n")}

‚Äé\nWant to know more? Try 'skills', 'experience', or 'projects'!
`
}

export function formatSkills(skills: Skill[]): string {
  const categories = [...new Set(skills.map((skill) => skill.category))]
  const width = getTerminalWidth()
  const isMobile = width < 50

  let output = `
${isMobile ? "‚ïê".repeat(width) : "‚ïî" + "‚ïê".repeat(width - 2) + "‚ïó"}
${isMobile ? " TECHNICAL SKILLS" : `‚ïë${"                    TECHNICAL SKILLS".padEnd(width - 2)}‚ïë`}
${isMobile ? "‚ïê".repeat(width) : "‚ïö" + "‚ïê".repeat(width - 2) + "‚ïù"}

üéØ EXPERTISE: ${createProgressBar(95)} 95%

`

  categories.forEach((category) => {
    const categorySkills = skills.filter((skill) => skill.category === category)
    output += `‚Äé\n${category.toUpperCase()}\n${"=".repeat(category.length)}\n\n`

    categorySkills.forEach((skill) => {
      const skillName = isMobile ? skill.name.substring(0, 15) : skill.name
      const padding = isMobile ? 15 : 25
      output += `  ‚Ä¢ ${skillName.padEnd(padding)} ${createProgressBar(skill.level)} ${skill.level}%\n`
    })
    output += "\n"
  })

  output += `‚Äé\n~Type 'projects' to see these skills in action!`
  return output
}

export function formatProjects(projects: Project[]): string {
  console.log(projects)
  const featuredProjects = projects.filter((p) => p.featured)
  const otherProjects = projects.filter((p) => !p.featured)
  const width = getTerminalWidth()
  const isMobile = width < 50

  let output = `
${isMobile ? "‚ïê".repeat(width) : "‚ïî" + "‚ïê".repeat(width - 2) + "‚ïó"}
${isMobile ? " MY PROJECTS" : `‚ïë${"                       MY PROJECTS".padEnd(width - 2)}‚ïë`}
${isMobile ? "‚ïê".repeat(width) : "‚ïö" + "‚ïê".repeat(width - 2) + "‚ïù"}

üöÄ FEATURED PROJECTS
${"=".repeat(20)}

`

  featuredProjects.forEach((project, index) => {
    if (isMobile) {
      // Mobile-friendly format
      output += `[${index + 1}] ${project.title}
      ${"‚îÄ".repeat(width)}
      Description: ${project.longDescription}

      Tech Stack: ${project.techStack.join(", ")}

      Features:
      ${project.features.map((f) => `‚úì ${f}`).join("\n")}

      ${project?.stats ? `Stats:
      ${Object.entries(project.stats)
            .map(([key, value]) => `${getStatIcon(key)} ${value}`)
            .join("\n")}` : ""}

      Links:
      üîó ${project.links.github || "N/A"}
      üåê ${project.links.live || "N/A"}`
    }

    else {
      // Desktop format with boxes
      output += createBox(`[${index + 1}] ${project.title}`, [
        `Description: ${project.longDescription}`,
        "",
        `Tech Stack: ${project.techStack.join(" ‚Ä¢ ")}`,
        "",
        "Features:",
        ...project.features.map((f) => `‚úì ${f}`),
        "",
        ...(project?.stats ?
          ["Stats:",
            ...Object.entries(project.stats).map(([key, value]) => `${getStatIcon(key)} ${value}`)
          ] : []),
        "",
        "Links:",
        `üîó ${project.links.github || "N/A"}`,
        `üåê ${project.links.live || "N/A"}`,
      ])
      output += "\n"
    }
  })

  if (otherProjects.length > 0) {
    output += `üí° OTHER NOTABLE PROJECTS
${"=".repeat(26)}

`
    otherProjects.forEach((project) => {
      if (isMobile) {
        output += `${project.title}
${project.longDescription}
Tech: ${project.techStack.join(", ")}
Link: ${project.links.live || project.links.github || "N/A"}

`
      } else {
        output += createBox(project.title, [
          project.longDescription,
          `Tech: ${project.techStack.join(", ")}`,
          `Link: ${project.links.live || project.links.github || "N/A"}`,
        ])
        output += "\n"
      }
    })
  }

  output += `üìà PROJECT PORTFOLIO SUMMARY
${"=".repeat(29)}
Total Projects Completed: ${projects.length}+
Total Lines of Code: 500,000+
GitHub Stars Earned: 1,200+
Active Contributors: 15+
Combined User Base: 50,000+

üèÜ RECOGNITION & ACHIEVEMENTS
${"=".repeat(29)}
‚Ä¢ Featured on Product Hunt (3 projects)
‚Ä¢ GitHub trending repositories (2 projects)
‚Ä¢ Dev.to featured articles about projects
‚Ä¢ Conference presentations on architecture
‚Ä¢ Open source contributions to major projects

Want to collaborate on something amazing?
Type 'contact' to get in touch! üöÄ
`

  return output
}

export function formatExperience(
  experiences: Experience[],
  education: Education,
  certifications: Certification[],
): string {
  const width = getTerminalWidth()
  const isMobile = width < 50

  let output = `
${isMobile ? "‚ïê".repeat(width) : "‚ïî" + "‚ïê".repeat(width - 2) + "‚ïó"}
${isMobile ? " WORK EXPERIENCE" : `‚ïë${"                   WORK EXPERIENCE".padEnd(width - 2)}‚ïë`}
${isMobile ? "‚ïê".repeat(width) : "‚ïö" + "‚ïê".repeat(width - 2) + "‚ïù"}

üíº PROFESSIONAL JOURNEY
${"=".repeat(23)}

`

  experiences.forEach((exp) => {
    output += `‚Äé\n[${exp.period}] üè¢ ${exp.title.toUpperCase()}
${exp.company} | ${exp.location}
‚îú‚îÄ‚îÄ ${exp.description}
‚îú‚îÄ‚îÄ Technologies: ${exp.technologies.join(", ")}
‚îú‚îÄ‚îÄ Achievements:
${exp.achievements.map((achievement) => `‚îÇ   ‚îú‚îÄ‚îÄ üéØ ${achievement}`).join("\n")}

`
  })

  output += `‚Äé\nüéì EDUCATION
${"=".repeat(12)}
‚Äé\n[${education.period}] ${education.degree}
${education.institution}
‚îú‚îÄ‚îÄ Relevant Coursework: ${education.coursework.join(", ")}
‚îú‚îÄ‚îÄ GPA: ${education.gpa}
‚îú‚îÄ‚îÄ Activities: ${education.activities.join(", ")}
‚îî‚îÄ‚îÄ Thesis: "${education.thesis}"

‚Äé\nüèÜ CERTIFICATIONS & ACHIEVEMENTS
${"=".repeat(32)}‚Äé\n
${certifications.map((cert) => `‚Ä¢ ${cert.name} (${cert.year})`).join("\n")}
‚Ä¢ Hackathon Winner - SF TechCrunch Disrupt (2021)
‚Ä¢ Open Source Contributor - 50+ repositories
‚Ä¢ Speaker at 3 tech conferences

‚Äé\nüìä IMPACT METRICS
${"=".repeat(17)}‚Äé\n
Projects Delivered: 50+
Team Members Mentored: 15+
Code Reviews Conducted: 500+
Bug Fix Rate: 95%
Client Satisfaction: 4.9/5

Type 'contact' to discuss opportunities!
`

  return output
}

export function formatBlog(posts: BlogPost[]): string {
  const featuredPost = posts.find((p) => p.featured)
  const otherPosts = posts.filter((p) => !p.featured)
  const width = getTerminalWidth()
  const isMobile = width < 50

  let output = `
${isMobile ? "‚ïê".repeat(width) : "‚ïî" + "‚ïê".repeat(width - 2) + "‚ïó"}
${isMobile ? " LATEST BLOG POSTS" : `‚ïë${"                   LATEST BLOG POSTS".padEnd(width - 2)}‚ïë`}
${isMobile ? "‚ïê".repeat(width) : "‚ïö" + "‚ïê".repeat(width - 2) + "‚ïù"}

üìù RECENT ARTICLES
${"=".repeat(18)}`

  if (featuredPost) {
    output += `‚Äé\n[üìå FEATURED] ${featuredPost.title}
‚îú‚îÄ‚îÄ Published: ${new Date(featuredPost.publishDate).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })}
‚îú‚îÄ‚îÄ Read time: ${featuredPost.readTime}
‚îú‚îÄ‚îÄ Tags: ${featuredPost.tags.join(", ")}
‚îú‚îÄ‚îÄ Summary: ${featuredPost.excerpt}
‚îî‚îÄ‚îÄ URL: https://thedevpiyush.com/blog/${featuredPost.id}
‚Äé\n`}

  otherPosts.forEach((post) => {
    const badge = post.trending ? "üî• TRENDING" : post.popular ? "üí° POPULAR" : "üìù ARTICLE"
    output += `[${badge}] ${post.title}
‚îú‚îÄ‚îÄ Published: ${new Date(post.publishDate).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })}
‚îú‚îÄ‚îÄ Read time: ${post.readTime}
‚îú‚îÄ‚îÄ Tags: ${post.tags.join(", ")}
‚îú‚îÄ‚îÄ Summary: ${post.excerpt}
‚îî‚îÄ‚îÄ URL: https://thedevpiyush.com/blog/${post.id}
‚Äé\n`
  })


  return output
}

export function formatContact(personal: PersonalInfo): string {
  const width = getTerminalWidth()
  const isMobile = width < 50

  return `
${isMobile ? "‚ïê".repeat(width) : "‚ïî" + "‚ïê".repeat(width - 2) + "‚ïó"}
${isMobile ? " CONTACT INFORMATION" : `‚ïë${"                   CONTACT INFORMATION".padEnd(width - 2)}‚ïë`}
${isMobile ? "‚ïê".repeat(width) : "‚ïö" + "‚ïê".repeat(width - 2) + "‚ïù"}

üìß LET'S CONNECT!
${"=".repeat(17)}

‚Äé\nPRIMARY CONTACT
${"=".repeat(15)}
üìß Email: ${personal.email}
   ‚îî‚îÄ‚îÄ Best for: Project inquiries, collaborations
   ‚îî‚îÄ‚îÄ Response time: Within 24 hours

üì± Phone: ${personal.phone}
   ‚îî‚îÄ‚îÄ Best for: Urgent matters, quick calls
   ‚îî‚îÄ‚îÄ Available: Mon-Fri, 9AM-6PM PST

üìç Location: ${personal.location}
   ‚îî‚îÄ‚îÄ Open to: Remote work worldwide, local meetups

‚Äé\nPROFESSIONAL NETWORKS
${"=".repeat(21)}
üíº LinkedIn: ${personal.social.linkedin}
   ‚îî‚îÄ‚îÄ Connect for: Professional networking

üêô GitHub: ${personal.social.github}
   ‚îî‚îÄ‚îÄ Check out: My open source projects

üê¶ Twitter: ${personal.social.twitter}
   ‚îî‚îÄ‚îÄ Follow for: Tech insights, development tips

üí¨ Discord: ${personal.social.discord}
   ‚îî‚îÄ‚îÄ Chat about: Tech discussions, gaming

‚Äé\nReady to start something amazing together? 
Drop me a line at ${personal.email}! üöÄ
`}

function getStatIcon(key: string): string {
  const icons: { [key: string]: string } = {
    users: "üë•",
    uptime: "‚ö°",
    transactions: "üí∞",
    mobile: "üì±",
    teams: "üè¢",
    projects: "üìä",
    messages: "üí¨",
    productivity: "üìà",
    content: "üìù",
    satisfaction: "üéØ",
    speed: "‚ö°",
  }
  return icons[key] || "üìä"
}
